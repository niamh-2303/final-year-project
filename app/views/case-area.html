<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Area - DFIR</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Your custom CSS -->
    <link rel="stylesheet" href="css/dashboard-style.css">
</head>
<body>

    <div class="container-fluid p-0">
        <div class="row g-0">
            
            <!-- LEFT SIDEBAR -->
            <nav class="col-md-2 sidebar">
                <!-- Logo Section -->
                <div class="sidebar-logo">
                    <div class="logo-wrapper">
                        <a href="dashboard.html">
                            <img src="images/logo.webp" alt="Logo" class="sidebar-logo-img">
                        </a>
                    </div>
                    <div class="logo-text">
                        <h5>DFIR</h5>
                        <small>Case Management</small>
                    </div>
                </div>

                <!-- Main Navigation -->
                <div class="sidebar-section">
                    <h6 class="sidebar-heading">MAIN</h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="dashboard.html">
                                <i class="bi bi-speedometer2"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="bi bi-folder"></i>
                                <span>Archive</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="bi bi-graph-up"></i>
                                <span>Reports</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Settings Section -->
                <div class="sidebar-section">
                    <h6 class="sidebar-heading">SHORTCUTS</h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="settings.html">
                                <i class="bi bi-gear"></i>
                                <span>Settings</span>
                            </a>
                        </li>
                        <li class="nav-item investigator-only">
                            <a class="nav-link" href="deleted-cases.html">
                                 <i class="bi bi-folder-minus"></i>
                                <span>Deleted Cases</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- User Profile at Bottom -->
                <div class="sidebar-profile">
                    <div class="profile-details">
                        <strong id="sidebarUserName">Loading...</strong>
                        <small id="sidebarUserRole">Investigator</small>
                    </div>
                </div>
            </nav>

            <!-- MAIN CONTENT -->
            <main class="col-md-10 main-content">
                
                <!-- Top Header -->
                <div class="content-header">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <div class="breadcrumb-nav">
                                <a href="dashboard.html" class="breadcrumb-link">
                                    <i class="bi bi-house-door"></i>
                                    <span>Home</span>
                                </a>
                                <i class="bi bi-chevron-right"></i>

                                <a href="dashboard.html" class="breadcrumb-link">
                                    <span>Cases</span>
                                </a>
                                <i class="bi bi-chevron-right"></i>
                                <span id="breadcrumbCaseNumber">Loading...</span>
                            </div>
                            <h1 class="page-title">
                                <span id="caseName">Loading...</span>
                                <span class="badge bg-success ms-2" id="caseStatus">Active</span>
                            </h1>
                            <p class="text-muted mb-0">
                                Case ID: <strong id="caseNumber">Loading...</strong> | 
                                Priority: <span class="badge bg-danger" id="casePriority">High</span>
                            </p>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-outline-secondary btn-blue-back" onclick="window.location.href='dashboard.html'">
                                <i class="bi bi-arrow-left"></i>
                                <span>Back to Dashboard</span>
                            </button>
                            
                            <!-- Profile Dropdown -->
                            <div class="dropdown">
                                <button class="btn btn-profile-header" id="profileButton" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="profile button">
                                    <i class="bi bi-person-circle"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end profile-dropdown-menu">
                                    <li class="dropdown-header">
                                        <div class="profile-info-dropdown">
                                            <strong id="userName">Loading...</strong>
                                            <small id="userEmail">user@example.com</small>
                                        </div>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item" href="#" onclick="logout()">
                                            <i class="bi bi-box-arrow-right"></i>
                                            Logout
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="case-tabs-scroll-wrapper">
                        <ul class="nav nav-tabs case-tabs" id="caseTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true" aria-label="overview-tab">
                                    <i class="bi bi-info-circle"></i> Overview
                                </button>
                            </li>

                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="team-tab" data-bs-toggle="tab" data-bs-target="#team" type="button" role="tab" aria-controls="team" aria-selected="false" aria-label="team-tab">
                                    <i class="bi bi-people"></i> Team
                                </button>
                            </li>
                            
                            <li class="nav-item investigator-only" role="presentation">
                                <button class="nav-link" id="audit-log-tab" data-bs-toggle="tab" data-bs-target="#auditLog" type="button" role="tab" aria-controls="auditLog" aria-selected="false" aria-label="audit-log-tab">
                                    <i class="bi bi-journal-code"></i> Audit Log
                                </button>
                            </li>

                            <li class="nav-item investigator-only" role="presentation">
                                <button class="nav-link" id="chain-of-custody-tab" data-bs-toggle="tab" data-bs-target="#chainOfCustody" type="button" role="tab" aria-controls="chainOfCustody" aria-selected="false" aria-label="chain-of-custody-tab">
                                    <i class="bi bi-shield-lock"></i> Chain of Custody
                                </button>
                            </li>
                            
                            <li class="nav-item investigator-only" role="presentation">
                                <button class="nav-link" id="evidence-upload-tab" data-bs-toggle="tab" data-bs-target="#evidenceUpload" type="button" role="tab" aria-controls="evidenceUpload" aria-selected="false" aria-label="evidence-upload-tab">
                                    <i class="bi bi-upload"></i> Upload
                                </button>
                            </li>

                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="evidence-tab" data-bs-toggle="tab" data-bs-target="#evidence" type="button" role="tab" aria-controls="evidence" aria-selected="false" aria-label="evidence-log-tab">
                                    <i class="bi bi-file-earmark-text"></i> Evidence Log
                                </button>
                            </li>
                            
                            
                            <li class="nav-item investigator-only" role="presentation">
                                <button class="nav-link" id="timeline-tab" data-bs-toggle="tab" data-bs-target="#timeline" type="button" role="tab" aria-controls="timeline" aria-selected="false" aria-label="timeline-tab">
                                    <i class="bi bi-clock-history"></i> Timeline
                                </button>
                            </li>

                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="findings-tab" data-bs-toggle="tab" data-bs-target="#findings" type="button" role="tab" aria-controls="findings" aria-selected="false" aria-label="findings-tab">
                                    <i class="bi bi-journal-text"></i> Findings
                                </button>
                            </li>
                            <li class="nav-item investigator-only" role="presentation">
                                <button class="nav-link" id="tools-tab" data-bs-toggle="tab" data-bs-target="#tools" type="button" role="tab" aria-controls="tools" aria-selected="false" aria-label="tools-tab">
                                    <i class="bi bi-tools"></i> Tools Used
                                </button>
                            </li>
                            
                            <li class="nav-item investigator-only" role="presentation">
                                <button class="nav-link" id="signoff-tab" data-bs-toggle="tab" data-bs-target="#signoff" type="button" role="tab" aria-controls="signoff" aria-selected="false" aria-label="signoff-tab">
                                    <i class="bi bi-check-square"></i> Report Sign-off
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="tab-content p-4" id="caseTabsContent">
                    
                    <!-- Overview Tab -->
                    <div class="tab-pane fade show active" id="overview" role="tabpanel">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-card case-page">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h4 class="form-card-title mb-0">
                                            <i class="bi bi-info-circle"></i>
                                            Case Overview
                                        </h4>
                                        <div>
                                            <button class="btn btn-sm btn-primary investigator-only" id="editOverviewBtn" onclick="toggleEditOverview()">
                                                <i class="bi bi-pencil"></i> Edit
                                            </button>
                                            <button class="btn btn-sm btn-success investigator-only" id="saveOverviewBtn" onclick="saveOverview()" style="display: none;">
                                                <i class="bi bi-check"></i> Save
                                            </button>
                                            <button class="btn btn-sm btn-secondary investigator-only" id="cancelOverviewBtn" onclick="cancelEditOverview()" style="display: none;">
                                                <i class="bi bi-x"></i> Cancel
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div id="overviewDisplay" class="overview-content">
                                        <p class="text-muted">Loading overview...</p>
                                    </div>
                                    
                                    <textarea 
                                        class="form-control investigator-only" 
                                        id="overviewTextarea" 
                                        rows="15" 
                                        style="display: none;"
                                        placeholder="Enter the case overview, background information, and initial assessment..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Enhanced Audit Log Tab -->
                    <div class="tab-pane fade" id="auditLog" role="tabpanel">
                        <div class="audit-log-container">
                            <!-- Header Section -->
                            <div class="audit-log-header">
                                <h4>
                                    <i class="bi bi-journal-code"></i>
                                    System Audit Log
                                </h4>
                                <p class="audit-log-subtitle">
                                    Cryptographically secured trail of all system events, user actions, and case modifications
                                </p>
                            </div>

                            <!-- Statistics Row -->
                            <div class="audit-stats-row">
                                <div class="audit-stat-card">
                                    <div class="audit-stat-icon total">
                                        <i class="bi bi-activity"></i>
                                    </div>
                                    <div class="audit-stat-content">
                                        <h6>Total Events</h6>
                                        <h3 id="totalEventsCount">0</h3>
                                    </div>
                                </div>

                                <div class="audit-stat-card">
                                    <div class="audit-stat-icon evidence">
                                        <i class="bi bi-file-earmark-lock"></i>
                                    </div>
                                    <div class="audit-stat-content">
                                        <h6>Evidence Events</h6>
                                        <h3 id="evidenceEventsCount">0</h3>
                                    </div>
                                </div>

                                <div class="audit-stat-card">
                                    <div class="audit-stat-icon verified">
                                        <i class="bi bi-shield-check"></i>
                                    </div>
                                    <div class="audit-stat-content">
                                        <h6>Verified Events</h6>
                                        <h3 id="verifiedEventsCount">0</h3>
                                    </div>
                                </div>

                                <div class="audit-stat-card">
                                    <div class="audit-stat-icon chain">
                                        <i class="bi bi-link-45deg"></i>
                                    </div>
                                    <div class="audit-stat-content">
                                        <h6>CoC Events</h6>
                                        <h3 id="cocEventsCount">0</h3>
                                    </div>
                                </div>
                            </div>

                            <!-- Filter and Search Controls -->
                            <div class="audit-controls">
                                <div class="audit-search">
                                    <i class="bi bi-search"></i>
                                    <input 
                                        type="text" 
                                        id="auditSearchInput"
                                        placeholder="Search events, actions, users, or hashes..." 
                                        onkeyup="searchAuditEvents(this.value)"
                                    >
                                </div>

                                <div class="audit-filter-buttons">
                                    <button class="audit-filter-btn active" onclick="filterAuditEvents('all')">
                                        <i class="bi bi-list-ul"></i>
                                        All Events
                                    </button>
                                    <button class="audit-filter-btn" onclick="filterAuditEvents('evidence')">
                                        <i class="bi bi-file-earmark"></i>
                                        Evidence
                                    </button>
                                    <button class="audit-filter-btn" onclick="filterAuditEvents('coc')">
                                        <i class="bi bi-link-45deg"></i>
                                        Chain of Custody
                                    </button>
                                    <button class="audit-filter-btn" onclick="filterAuditEvents('verified')">
                                        <i class="bi bi-shield-check"></i>
                                        Verified
                                    </button>
                                </div>

                                <button class="audit-export-btn" onclick="exportAuditLog()">
                                    <i class="bi bi-download"></i>
                                    Export Log
                                </button>
                            </div>

                            <!-- Timeline Container -->
                            <div class="audit-timeline-view" id="auditTimelineContainer">
                                <!-- Events will be dynamically inserted here -->
                                <div class="audit-loading">
                                    <div class="audit-loading-spinner"></div>
                                    <p>Loading audit log...</p>
                                </div>
                            </div>

                            <!-- Information Banner -->
                            <div style="padding: 20px 32px; background: #f8f9fa; border-top: 1px solid #e9ecef;">
                                <div class="alert alert-info mb-0 d-flex align-items-center">
                                    <i class="bi bi-info-circle fs-4 me-3"></i>
                                    <div>
                                        <strong>About the Audit Log</strong><br>
                                        <small>
                                            This log records all system events with cryptographic hashing to ensure integrity. 
                                            Each event is timestamped and linked to create an immutable chain. Events marked with 
                                            <span class="badge bg-primary">CoC Linked</span> are connected to physical Chain of Custody records.
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Chain of Custody Tab (NIST Compliant) -->
                    <div class="tab-pane fade" id="chainOfCustody" role="tabpanel">
                        <div class="form-card case-page">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="form-card-title mb-0">
                                    <i class="bi bi-shield-lock"></i>
                                    Chain of Custody
                                </h4>
                                <button class="btn btn-primary investigator-only" onclick="showAddCoCEventModal()">
                                    <i class="bi bi-plus-circle"></i> Add CoC Event
                                </button>
                            </div>

                            <!-- NIST Compliance Banner -->
                            <div class="alert alert-info d-flex align-items-center mb-4">
                                <i class="bi bi-info-circle fs-4 me-3"></i>
                                <div>
                                    <strong>NIST SP 800-86 Compliant Chain of Custody</strong><br>
                                    <small>This log documents all custody transfers, access events, and integrity verifications for digital evidence in accordance with NIST guidelines. Each event records who possessed the evidence, when, where, why, and in what condition.</small>
                                </div>
                            </div>

                            <!-- CoC Timeline -->
                            <div id="cocTimeline" class="coc-timeline">
                                <p class="text-muted">Loading chain of custody records...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Evidence Upload -->
                    <div class="tab-pane fade" id="evidenceUpload" role="tabpanel">
                        <div class="form-card case-page">
                            <h4 class="form-card-title">
                                <i class="bi bi-upload"></i>
                                Evidence Upload
                            </h4>
                            
                            <div id="fileControls">
                                <input type="file" id="fileInput" accept="image/*">
                                <button id="clearFileButton" style="display: none;">Clear & Upload Another File</button>
                            </div>

                            <div id="resultsSection" class="hidden">
                                <div class="section">
                                    <h5>File Hash</h5>
                                    <p><code id="hashOutput">Calculating...</code></p>
                                </div>

                                <div class="section">
                                    <h5>File Metadata</h5>
                                    <table id="metadataTable">
                                        <thead>
                                            <tr>
                                                <th>Property</th>
                                                <th>Value</th>
                                            </tr>
                                        </thead>
                                        <tbody id="metadataBody">
                                            <tr>
                                                <td colspan="2">Loading metadata...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div class="section mt-3">
                                    <label for="evidenceSummary" class="form-label">
                                        <h5>Evidence Summary</h5>
                                    </label>
                                    <textarea 
                                        class="form-control" 
                                        id="evidenceSummary" 
                                        rows="4" 
                                        placeholder="Enter a brief description of this evidence..."></textarea>
                                </div>

                                <button id="submitEvidenceButton" class="btn btn-success mt-3">Upload Evidence</button>
                            </div>
                        </div>
                    </div>

                    <!-- Evidence Log Tab -->
                    <div class="tab-pane fade" id="evidence" role="tabpanel">
                        <div class="evidence-list-container">
                            <!-- Header -->
                            <div class="evidence-list-header">
                                <h4>
                                    <i class="bi bi-file-earmark-text"></i>
                                    Evidence Files
                                    <span class="evidence-count-badge" id="evidenceCountBadge">0</span>
                                </h4>
                            </div>

                            <!-- Audit Alert -->
                            <div style="padding: 24px 32px 0 32px;">
                                <div class="evidence-audit-alert">
                                    <i class="bi bi-shield-check"></i>
                                    <div class="evidence-audit-alert-text">
                                        <strong>Access Tracking Enabled:</strong> All evidence views are logged to the audit trail for compliance and chain of custody documentation.
                                    </div>
                                </div>
                            </div>

                            <!-- Evidence List Table -->
                            <div class="evidence-table-wrapper">
                                <div id="evidenceListContainer">
                                    <!-- Table will be dynamically inserted here -->
                                    <div class="evidence-loading">
                                        <div class="evidence-loading-spinner"></div>
                                        <p>Loading evidence...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Team Tab -->
                    <div class="tab-pane fade" id="team" role="tabpanel">
                        <div class="form-card case-page">
                            <h4 class="form-card-title">
                                <i class="bi bi-people"></i> Team Members
                            </h4>

                            <div class="team-group">
                                <h5>Lead Investigator</h5>
                                <div id="leadInvestigator" class="team-member"></div>
                            </div>

                            <div class="team-group">
                                <h5>Investigators</h5>
                                <div id="otherInvestigators" class="team-member-list"></div>
                            </div>

                            <div class="team-group">
                                <h5>Client</h5>
                                <div id="clientInfo" class="team-member"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Findings Tab -->
                    <div class="tab-pane fade" id="findings" role="tabpanel">
                        <div class="form-card case-page">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h4 class="form-card-title mb-0">
                                    <i class="bi bi-journal-text"></i>
                                    Case Findings & Recommendations
                                </h4>
                                <div>
                                    <button class="btn btn-sm btn-primary investigator-only" id="editFindingsBtn" onclick="toggleEditFindings()">
                                        <i class="bi bi-pencil"></i> Edit
                                    </button>
                                    <button class="btn btn-sm btn-success investigator-only" id="saveFindingsBtn" onclick="saveFindings()" style="display: none;">
                                        <i class="bi bi-check"></i> Save
                                    </button>
                                    <button class="btn btn-sm btn-secondary investigator-only" id="cancelFindingsBtn" onclick="cancelEditFindings()" style="display: none;">
                                        <i class="bi bi-x"></i> Cancel
                                    </button>
                                </div>
                            </div>
                            
                            <div id="findingsDisplay" class="findings-content">
                                <h5>Findings</h5>
                                <div id="findingsText" class="content-display">
                                    <p class="text-muted">Loading findings...</p>
                                </div>
                                
                                <h5 class="mt-4">Recommendations</h5>
                                <div id="recommendationsText" class="content-display">
                                    <p class="text-muted">Loading recommendations...</p>
                                </div>
                            </div>
                            
                            <div id="findingsEdit" style="display: none;">
                                <div class="mb-3">
                                    <label for="findingsTextarea" class="form-label"><strong>Findings</strong></label>
                                    <textarea 
                                        class="form-control" 
                                        id="findingsTextarea" 
                                        rows="10"
                                        placeholder="Document your investigation findings, analysis results, and key discoveries..."></textarea>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="recommendationsTextarea" class="form-label"><strong>Recommendations</strong></label>
                                    <textarea 
                                        class="form-control" 
                                        id="recommendationsTextarea" 
                                        rows="8"
                                        placeholder="Provide recommendations for remediation, future prevention, and next steps..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                   <!-- Timeline Tab -->
                    <div class="tab-pane fade" id="timeline" role="tabpanel">
                        <div class="form-card case-page">
                            <h4 class="form-card-title">
                                <i class="bi bi-clock-history"></i>
                                Evidence Timeline
                            </h4>
                            <p class="text-muted mb-4">Timeline based on EXIF metadata from evidence files</p>
                            
                            <div id="evidenceTimeline" class="evidence-timeline">
                                <p class="text-muted">Loading timeline...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tools Used Tab -->
                    <div class="tab-pane fade" id="tools" role="tabpanel">
                        <div class="form-card case-page">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h4 class="form-card-title mb-0">
                                    <i class="bi bi-tools"></i>
                                    Tools Used
                                </h4>
                                <button class="btn btn-sm btn-primary investigator-only" onclick="showAddToolModal()">
                                    <i class="bi bi-plus-circle"></i> Add Tool
                                </button>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-striped" id="toolsTable">
                                    <thead>
                                        <tr>
                                            <th>Tool Name</th>
                                            <th>Version</th>
                                            <th>Purpose</th>
                                            <th>Added</th>
                                            <th class="investigator-only">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="toolsTableBody">
                                        <tr>
                                            <td colspan="5" class="text-muted text-center">No tools added yet</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>


                <!-- Sign off and generate report -->
                <div class="tab-pane fade" id="signoff" role="tabpanel">
                    <div class="form-card case-page">
                        <h4 class="form-card-title">
                             <i class="bi bi-check-square"></i>
                             Generate Report
                        </h4>
                        <p class="text-muted">Sign off and generate report section content will go here...</p>
                    </div>
                 </div>
                </div>

            </main>
        
        </div>
    </div>

    <!-- Add Tool Modal -->
    <div class="modal fade" id="addToolModal" tabindex="-1" aria-labelledby="addToolModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addToolModalLabel">
                        <i class="bi bi-tools"></i> Add Tool
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="toolName" class="form-label">Tool Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="toolName" placeholder="e.g., Autopsy" required>
                    </div>
                    <div class="mb-3">
                        <label for="toolVersion" class="form-label">Version</label>
                        <input type="text" class="form-control" id="toolVersion" placeholder="e.g., 4.19.3">
                    </div>
                    <div class="mb-3">
                        <label for="toolPurpose" class="form-label">Purpose</label>
                        <textarea class="form-control" id="toolPurpose" rows="3" placeholder="e.g., Disk image analysis and file recovery"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addTool()">Add Tool</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add CoC Event Modal -->
    <div class="modal fade" id="addCoCEventModal" tabindex="-1" aria-labelledby="addCoCEventModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addCoCEventModalLabel">
                        <i class="bi bi-shield-lock"></i> Add Chain of Custody Event
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="cocEventForm">
                        <!-- Evidence Selection -->
                        <div class="mb-3">
                            <label for="cocEvidenceId" class="form-label">Evidence Item <span class="text-danger">*</span></label>
                            <select class="form-select" id="cocEvidenceId" required>
                                <option value="">Select evidence...</option>
                            </select>
                        </div>

                        <!-- Event Type -->
                        <div class="mb-3">
                            <label for="cocEventType" class="form-label">Event Type <span class="text-danger">*</span></label>
                            <select class="form-select" id="cocEventType" required onchange="updateCoCFormFields()">
                                <option value="">Select event type...</option>
                                <option value="ACQUIRED">Initial Acquisition</option>
                                <option value="TRANSFERRED">Custody Transfer</option>
                                <option value="ACCESSED">Access/Handling</option>
                                <option value="VERIFIED">Hash Verification</option>
                                <option value="STORED">Storage Change</option>
                                <option value="DISPOSED">Final Disposition</option>
                            </select>
                        </div>

                        <!-- Custody Transfer Fields (show for TRANSFERRED) -->
                        <div id="transferFields" style="display: none;">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="releasedBy" class="form-label">Released By</label>
                                    <input type="text" class="form-control" id="releasedBy" placeholder="Name">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="releasedByRole" class="form-label">Role</label>
                                    <input type="text" class="form-control" id="releasedByRole" placeholder="e.g., Lead Investigator">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="receivedBy" class="form-label">Received By</label>
                                    <input type="text" class="form-control" id="receivedBy" placeholder="Name">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="receivedByRole" class="form-label">Role</label>
                                    <input type="text" class="form-control" id="receivedByRole" placeholder="e.g., Forensic Analyst">
                                </div>
                            </div>
                        </div>

                        <!-- Access Type (show for ACCESSED) -->
                        <div id="accessFields" style="display: none;">
                            <div class="mb-3">
                                <label for="accessType" class="form-label">Access Type</label>
                                <select class="form-select" id="accessType">
                                    <option value="READ_ONLY">Read-Only Examination</option>
                                    <option value="IMAGING">Forensic Imaging</option>
                                    <option value="ANALYSIS">Analysis/Processing</option>
                                    <option value="VERIFICATION">Integrity Verification</option>
                                </select>
                            </div>
                        </div>

                        <!-- Hash Verification Fields (show for VERIFIED) -->
                        <div id="verificationFields" style="display: none;">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="hashAlgorithm" class="form-label">Hash Algorithm</label>
                                    <input type="text" class="form-control" id="hashAlgorithm" name="hashAlgorithm" value="SHA-256" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="hashMatch" class="form-label">Hash Match Result</label>
                                    <select class="form-select" id="hashMatch">
                                        <option value="true">Match - Integrity Verified</option>
                                        <option value="false">Mismatch - Integrity Compromised</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Common Fields -->
                        <div class="mb-3">
                            <label for="cocReason" class="form-label">Reason/Purpose <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="cocReason" placeholder="e.g., Initial acquisition from suspect laptop" required>
                        </div>

                        <div class="mb-3">
                            <label for="cocLocation" class="form-label">Location</label>
                            <input type="text" class="form-control" id="cocLocation" placeholder="e.g., Evidence Locker A3, Forensic Lab">
                        </div>

                        <div class="mb-3">
                            <label for="cocCondition" class="form-label">Condition at Event</label>
                            <textarea class="form-control" id="cocCondition" rows="2" placeholder="e.g., Sealed, powered off, no visible damage"></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="cocSecurityControls" class="form-label">Security Controls</label>
                            <input type="text" class="form-control" id="cocSecurityControls" placeholder="e.g., Locked cabinet, encrypted drive">
                        </div>

                        <div class="mb-3">
                            <label for="cocNotes" class="form-label">Additional Notes</label>
                            <textarea class="form-control" id="cocNotes" rows="3" placeholder="Any additional relevant information..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitCoCEvent()">
                        <i class="bi bi-check-circle"></i> Add CoC Event
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Evidence Detail Modal -->
    <div class="modal fade evidence-detail-modal" id="evidenceDetailModal" tabindex="-1" aria-labelledby="evidenceModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h5 class="modal-title" id="evidenceModalLabel">
                        <i class="bi bi-file-earmark-lock"></i>
                        <span id="evidenceModalTitle">Evidence Details</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <!-- Modal Body -->
                <div class="modal-body">
                    <!-- Image Preview Section -->
                    <div class="evidence-detail-section">
                        <h5>
                            <i class="bi bi-image"></i>
                            Image Preview
                        </h5>
                        <div class="evidence-image-preview" id="evidenceImagePreview">
                            <!-- Image will be inserted here -->
                        </div>
                    </div>

                    <!-- File Information Section -->
                    <div class="evidence-detail-section">
                        <h5>
                            <i class="bi bi-info-circle"></i>
                            File Information
                        </h5>
                        <div class="evidence-info-grid">
                            <div class="evidence-info-item">
                                <div class="evidence-info-label">File Name</div>
                                <div class="evidence-info-value" id="evidenceFileName">-</div>
                            </div>
                            <div class="evidence-info-item">
                                <div class="evidence-info-label">File Size</div>
                                <div class="evidence-info-value" id="evidenceFileSize">-</div>
                            </div>
                            <div class="evidence-info-item">
                                <div class="evidence-info-label">File Type</div>
                                <div class="evidence-info-value" id="evidenceFileType">-</div>
                            </div>
                            <div class="evidence-info-item">
                                <div class="evidence-info-label">Date Collected</div>
                                <div class="evidence-info-value" id="evidenceCollectedDate">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- Hash Section -->
                    <div class="evidence-detail-section">
                        <h5>
                            <i class="bi bi-shield-check"></i>
                            File Hash (SHA-256)
                        </h5>
                        <div class="evidence-info-value" id="evidenceFullHash">
                            <code>-</code>
                        </div>
                    </div>

                    <!-- Description Section -->
                    <div class="evidence-detail-section">
                        <h5>
                            <i class="bi bi-file-text"></i>
                            Description
                        </h5>
                        <div id="evidenceFullDescription">
                            <div class="text-muted">No description provided</div>
                        </div>
                    </div>

                    <!-- EXIF Metadata Section -->
                    <div class="evidence-detail-section">
                        <h5>
                            <i class="bi bi-list-ul"></i>
                            EXIF Metadata
                        </h5>
                        <table class="metadata-table">
                            <tbody id="evidenceMetadataBody">
                                <tr>
                                    <td colspan="2" class="text-muted text-center">Loading metadata...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="modal-footer">
                    <button type="button" class="evidence-action-btn secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle"></i>
                        Close
                    </button>
                    <button type="button" class="evidence-action-btn primary" onclick="downloadEvidenceFile()">
                        <i class="bi bi-download"></i>
                        Download File
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
    <script src="js/logout.js"></script>
    <script src="js/profile.js"></script>
    <script src="js/case-area.js"></script>
    <script src="js/case-area-navigation.js"></script>
  
</body>
</html>